<launch>
  <!--
    Swarm system launcher
    - Starts the WebSocket bridge, decision node, and manager
    - Provides arguments to tweak host/port, grid size, and command topic
  -->

  <!-- Arguments with sensible defaults -->
  <arg name="ws_host" default="0.0.0.0" />
  <arg name="ws_port" default="8765" />
  <arg name="command_topic" default="/system/command" />
  <arg name="start_scheduler" default="true" />

  <!-- WebSocket Bridge Node -->
  <node pkg="swarm_manage" type="esp_websocket_node.py" name="esp_websocket" output="screen">
    <param name="host" value="$(arg ws_host)" />
    <param name="port" value="$(arg ws_port)" />
    <param name="topic" value="/bot/cmd" />
  </node>

  <!-- Decision Node (zig-zag) -->
  <node pkg="swarm_manage" type="esp_decision_node.py" name="esp_decision" output="screen">
    <param name="cmd_topic" value="/bot/cmd" />
    <param name="status_topic" value="/bot/status_raw" />
    <param name="row_pause" value="0.25" />
    <param name="step_interval" value="0.3" />
  </node>

  <!-- Removed action server; single-bot zig-zag handled by esp_decision_node -->

  <!-- Swarm Manager Node -->
  <node pkg="swarm_manage" type="swarm_manager_node.py" name="swarm_manager" output="screen">
    <param name="command_topic" value="$(arg command_topic)" />
  </node>

  <!-- Scheduler Node (optional) -->
  <group if="$(arg start_scheduler)">
    <node pkg="swarm_manage" type="scheduler_node.py" name="scheduler" output="screen">
      <param name="command_topic" value="$(arg command_topic)" />
      <!-- Topics to control scheduler: /scheduler/set_daily_alarm (String), /scheduler/set_timer (Int32) -->
    </node>
  </group>

</launch>
